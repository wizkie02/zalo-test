<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zalo API Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #0d6efd, #6610f2);
            --secondary-gradient: linear-gradient(135deg, #6c757d, #495057);
            --success-gradient: linear-gradient(135deg, #198754, #0f5132);
            --info-gradient: linear-gradient(135deg, #0dcaf0, #055160);
            --warning-gradient: linear-gradient(135deg, #ffc107, #cc9a06);
        }

        body {
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        .navbar {
            background: var(--primary-gradient) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .nav-link {
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            transform: translateY(-1px);
        }

        .welcome-text {
            color: white;
            margin-right: 15px;
            font-weight: 500;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 25px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            border-radius: 15px 15px 0 0 !important;
            padding: 1.25rem;
        }

        .card-header.bg-primary {
            background: var(--primary-gradient) !important;
        }

        .card-header.bg-success {
            background: var(--success-gradient) !important;
        }

        .card-header.bg-info {
            background: var(--info-gradient) !important;
        }

        .card-header.bg-warning {
            background: var(--warning-gradient) !important;
        }

        .card-header.bg-secondary {
            background: var(--secondary-gradient) !important;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-control {
            border-radius: 8px;
            padding: 0.75rem 1rem;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
        }

        .result-area {
            max-height: 300px;
            overflow-y: auto;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #eee;
        }

        pre.json {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #eee;
            max-height: 300px;
            overflow-y: auto;
        }

        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 30px;
        }

        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
            padding: 1rem 1.5rem;
            position: relative;
        }

        .nav-tabs .nav-link:after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: #0d6efd;
            background: transparent;
            border: none;
        }

        .nav-tabs .nav-link.active:after {
            transform: scaleX(1);
        }

        .table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .table thead th {
            background: var(--secondary-gradient);
            color: white;
            font-weight: 500;
            border: none;
        }

        .endpoint-template {
            display: none;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-robot me-2"></i>Zalo API</a>
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="/zalo-login"><i class="fas fa-qrcode me-1"></i>Login QR</a>
                <a class="nav-link" href="/accounts"><i class="fas fa-users me-1"></i>Tài khoản</a>
                <a class="nav-link active" href="/dashboard"><i class="fas fa-columns me-1"></i>Dashboard</a>
            </div>
            <div class="d-flex align-items-center">
                <span class="welcome-text" id="welcomeMessage"><i class="fas fa-user-circle me-2"></i>Xin chào </span>
                <button class="btn btn-outline-light" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Đăng xuất</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>Tài khoản đang sử dụng</h5>
                    </div>
                    <div class="card-body">
                        <div id="currentAccount"></div>
                    </div>
                </div>
            </div>
        </div>

        <ul class="nav nav-tabs" id="apiTabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#search">
                    <i class="fas fa-search me-2"></i>Tìm kiếm
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#message">
                    <i class="fas fa-comment-alt me-2"></i>Tin nhắn
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#accounts">
                    <i class="fas fa-users-cog me-2"></i>Quản lý tài khoản
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#apitest">
                    <i class="fas fa-code me-2"></i>Test API
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <!-- Tab Tìm kiếm -->
            <div class="tab-pane fade show active" id="search">
                <div class="card api-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-search me-2"></i>Tìm người dùng qua số điện thoại</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="phone" placeholder="Nhập số điện thoại (VD: 0912345678)">
                        </div>
                        <button class="btn btn-primary" onclick="findUser()"><i class="fas fa-search me-2"></i>Tìm kiếm</button>
                        <div id="findUserResult" class="mt-3 result-area"></div>
                    </div>
                </div>
            </div>

            <!-- Tab Tin nhắn -->
            <div class="tab-pane fade" id="message">
                <!-- Gửi tin nhắn văn bản -->
                <div class="card api-card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-comment-alt me-2"></i>Gửi tin nhắn văn bản</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Phương thức nhận diện người nhận</label>
                            <select class="form-select mb-3" id="messageIdentifyMethod" onchange="toggleMessageInputFields()">
                                <option value="userId">Theo User ID</option>
                                <option value="phone">Theo số điện thoại</option>
                            </select>
                            <input type="text" class="form-control mb-3" id="messageThreadId" placeholder="Thread ID người nhận">
                            <input type="text" class="form-control mb-3" id="messagePhone" placeholder="Số điện thoại người nhận" style="display: none;">
                            <textarea class="form-control" id="messageContent" rows="3" placeholder="Nội dung tin nhắn"></textarea>
                        </div>
                        <button class="btn btn-success" onclick="sendMessageUnified()">
                            <i class="fas fa-paper-plane me-2"></i>Gửi tin nhắn
                        </button>
                        <div id="sendMessageResult" class="mt-3 result-area"></div>
                    </div>
                </div>

                <!-- Gửi hình ảnh -->
                <div class="card api-card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-image me-2"></i>Gửi hình ảnh</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Phương thức nhận diện người nhận</label>
                            <select class="form-select mb-3" id="imageIdentifyMethod" onchange="toggleImageInputFields()">
                                <option value="userId">Theo User ID</option>
                                <option value="phone">Theo số điện thoại</option>
                            </select>
                            <input type="text" class="form-control mb-3" id="imageThreadId" placeholder="Thread ID người nhận">
                            <input type="text" class="form-control mb-3" id="imagePhone" placeholder="Số điện thoại người nhận" style="display: none;">
                            <input type="text" class="form-control" id="imagePath" placeholder="URL hình ảnh">
                        </div>
                        <button class="btn btn-info" onclick="sendImageUnified()">
                            <i class="fas fa-paper-plane me-2"></i>Gửi ảnh
                        </button>
                        <div id="sendImageResult" class="mt-3 result-area"></div>
                    </div>
                </div>
            </div>

            <!-- Tab Quản lý tài khoản -->
            <div class="tab-pane fade" id="accounts">
                <div class="card api-card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0"><i class="fas fa-users-cog me-2"></i>Danh sách tài khoản</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning mb-3" onclick="loadAccounts()"><i class="fas fa-sync-alt me-2"></i>Làm mới danh sách</button>
                        <div id="accountsList" class="result-area"></div>
                    </div>
                </div>
            </div>

            <!-- Tab Test API -->
            <div class="tab-pane fade" id="apitest">
                <div class="card api-card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>Test API tùy chỉnh</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <select class="form-select mb-2" id="apiMethod">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                            <select class="form-select mb-2" id="apiEndpoint" onchange="updateRequestBody(); document.getElementById('apiMethod').value = 'POST';">
                                <option value="">Chọn API Endpoint</option>
                                <!-- Friends Management -->
                                <option value="/getAllFriends">Lấy tất cả bạn bè (/getAllFriends)</option>
                                <option value="/findUser">Tìm người dùng (/findUser)</option>
                                <option value="/getUserInfo">Lấy thông tin người dùng (/getUserInfo)</option>
                                <option value="/sendFriendRequest">Gửi lời mời kết bạn (/sendFriendRequest)</option>
                                <option value="/acceptFriendRequest">Chấp nhận lời mời kết bạn (/acceptFriendRequest)</option>
                                <option value="/blockUser">Chặn người dùng (/blockUser)</option>
                                <option value="/unblockUser">Bỏ chặn người dùng (/unblockUser)</option>
                                <option value="/changeFriendAlias">Đổi biệt danh bạn bè (/changeFriendAlias)</option>

                                <!-- Group Management -->
                                <option value="/createGroup">Tạo nhóm mới (/createGroup)</option>
                                <option value="/getAllGroups">Lấy tất cả nhóm (/getAllGroups)</option>
                                <option value="/getGroupInfo">Lấy thông tin nhóm (/getGroupInfo)</option>
                                <option value="/addUserToGroup">Thêm thành viên vào nhóm (/addUserToGroup)</option>
                                <option value="/removeUserFromGroup">Xóa thành viên khỏi nhóm (/removeUserFromGroup)</option>
                                <option value="/changeGroupName">Đổi tên nhóm (/changeGroupName)</option>
                                <option value="/changeGroupAvatar">Đổi ảnh nhóm (/changeGroupAvatar)</option>

                                <!-- Messages and Media -->
                                <option value="/sendmessage">Gửi tin nhắn văn bản (/sendmessage)</option>
                                <option value="/sendMessageByPhoneNumber">Gửi tin nhắn qua SĐT (/sendMessageByPhoneNumber)</option>
                                <option value="/sendImageToUser">Gửi ảnh cho người dùng (/sendImageToUser)</option>
                                <option value="/sendImageByPhoneNumber">Gửi ảnh qua SĐT (/sendImageByPhoneNumber)</option>
                                <option value="/sendImagesToUser">Gửi nhiều ảnh cho người dùng (/sendImagesToUser)</option>
                                <option value="/sendImageToGroup">Gửi ảnh vào nhóm (/sendImageToGroup)</option>
                                <option value="/sendImagesToGroup">Gửi nhiều ảnh vào nhóm (/sendImagesToGroup)</option>
                            </select>
                            <textarea class="form-control" id="apiBody" rows="5" placeholder="Request body (JSON)"></textarea>
                        </div>
                        <button class="btn btn-secondary" onclick="testAPI()"><i class="fas fa-paper-plane me-2"></i>Gửi request</button>
                        <div id="apiTestResult" class="mt-3">
                            <pre class="json"></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Templates (hidden) -->
            <div class="endpoint-template" id="template-findUser">
{
    "ownId": "your_account_id",
    "phone": "0912345678"
}</div>

            <div class="endpoint-template" id="template-getUserInfo">
{
    "ownId": "your_account_id",
    "userId": "user_id"
}</div>

            <div class="endpoint-template" id="template-sendFriendRequest">
{
    "ownId": "your_account_id",
    "userId": "user_id_to_add"
}</div>

            <div class="endpoint-template" id="template-sendmessage">
{
    "ownId": "your_account_id",
    "threadId": "thread_id",
    "message": "Hello, this is a test message",
    "type": "User"
}</div>

            <div class="endpoint-template" id="template-sendMessageByPhoneNumber">
{
    "ownId": "your_account_id",
    "phone": "0912345678",
    "message": "Hello, this is a test message"
}</div>

            <div class="endpoint-template" id="template-createGroup">
{
    "ownId": "your_account_id",
    "name": "Group Name",
    "members": ["user_id_1", "user_id_2"]
}</div>

            <div class="endpoint-template" id="template-getGroupInfo">
{
    "ownId": "your_account_id",
    "groupId": "group_id"
}</div>

            <div class="endpoint-template" id="template-addUserToGroup">
{
    "ownId": "your_account_id",
    "groupId": "group_id",
    "memberId": "user_id_to_add"
}</div>

            <div class="endpoint-template" id="template-removeUserFromGroup">
{
    "ownId": "your_account_id",
    "groupId": "group_id",
    "memberId": "user_id_to_remove"
}</div>

            <div class="endpoint-template" id="template-sendImageToUser">
{
    "ownId": "your_account_id",
    "threadId": "thread_id",
    "imagePath": "url_to_image"
}</div>

            <div class="endpoint-template" id="template-sendImageByPhoneNumber">
{
    "ownId": "your_account_id",
    "phone": "0912345678",
    "imagePath": "url_to_image"
}</div>

            <div class="endpoint-template" id="template-sendImagesToUser">
{
    "ownId": "your_account_id",
    "threadId": "thread_id",
    "imagePaths": ["url_to_image1", "url_to_image2"]
}</div>

            <div class="endpoint-template" id="template-sendImageToGroup">
{
    "ownId": "your_account_id",
    "threadId": "group_id",
    "imagePath": "url_to_image"
}</div>

            <div class="endpoint-template" id="template-sendImagesToGroup">
{
    "ownId": "your_account_id",
    "threadId": "group_id",
    "imagePaths": ["url_to_image1", "url_to_image2"]
}</div>

            <div class="endpoint-template" id="template-acceptFriendRequest">
{
    "ownId": "your_account_id",
    "userId": "user_id_to_accept"
}</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/dashboard.js"></script>
</body>
</html>